# -----------------------------------------------------------------------------
# Project: Industrial IoT – Sensor Ingestion Service
# File: src/main/resources/application.yml
# Purpose:
#   Centralized configuration for HTTP + Kafka producer.
#   Designed to run consistently across:
#     - Local dev
#     - Docker / Kubernetes
#     - CI environments
#
#   Compatible with Spring for Apache Kafka 4.x
# -----------------------------------------------------------------------------

spring:
  application:
    name: sensor-ingestion-service

  # ---------------------------------------------------------------------------
  # Kafka Producer Configuration (Spring for Apache Kafka 4.x)
  # ---------------------------------------------------------------------------
  kafka:
    bootstrap-servers: ${KAFKA_BROKERS:kafka:9092}

    producer:
      # Partitioning strategy:
      #   key = sensorId  → preserves per-sensor ordering
      key-serializer: org.apache.kafka.common.serialization.StringSerializer

      # ✅ Jackson 3–based JSON serializer (NOT deprecated)
      value-serializer: org.springframework.kafka.support.serializer.JacksonJsonSerializer

      # Delivery guarantees
      acks: all
      retries: 2147483647          # Effectively unlimited (bounded by delivery.timeout.ms)

      # Performance tuning (safe defaults)
      linger-ms: 10                # Small batching delay
      batch-size: 32768            # 32 KB batches
      compression-type: snappy     # Industry-standard compression

      properties:
        # Exactly-once safety (idempotent producer)
        enable.idempotence: true
        max.in.flight.requests.per.connection: 5

        # Upper bound for retries
        delivery.timeout.ms: 120000

        # Do NOT add Java type headers (clean JSON payloads)
        spring.json.add.type.headers: false

# ---------------------------------------------------------------------------
# HTTP Server Configuration
# ---------------------------------------------------------------------------
server:
  port: ${SERVER_PORT:8080}

# ---------------------------------------------------------------------------
# Application-Specific Configuration
# ---------------------------------------------------------------------------
app:
  topics:
    # Kafka topic for sensor ingestion events
    sensor-readings: ${TOPIC_SENSOR_READINGS:sensor-readings}

  # ⚠️ Dev-only token (replace with OAuth2 / mTLS in prod)
  ingest-auth-token: ${INGEST_AUTH_TOKEN:dev-token}
